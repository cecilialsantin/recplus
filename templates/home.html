{% extends "base.html" %}

{% block title %}RecPlus - Dashboard{% endblock %}

{% block content %}

    <!-- Contenedor de bienvenida -->
    <div class="welcome-bar">
        <h2>
            <i class="fas fa-user"></i>
            <span id="username-display"></span>
        </h2>
        <button class="logout-btn" onclick="logout()">
            <i class="fas fa-sign-out-alt"></i> Logout
        </button>   

        <button id="btn-abrir-modal" class="btn-modificar-partida">
            <i class="fas fa-edit"></i> Modificar Partida
        </button>

        <button class="selenium-btn" onclick="window.location.href='/automatizacion'">
            <i class="fa-solid fa-robot"></i> Automatizar Loyal
        </button> 
        
            <!-- üîπ Secci√≥n de administraci√≥n (solo visible si es admin) -->
    <div id="admin-section">
        <button class="admin-btn" onclick="window.location.href='/admin/usuarios'">
            <i class="fas fa-user-plus"></i>Usuarios
        </button>
        <button class="admin-btn" onclick="window.location.href='/admin/productosBase'">
            <i class="fas fa-box"></i>Productos Base
        </button>
    </div>

    </div>

    <!-- Contenedor de dos columnas -->
    <div class="home-container grid-container">



    <!-- Modal para modificar partidas manualmente -->
        <div id="modalPartida" class="modal">
            <div class="modal-content">
                <span class="close" onclick="cerrarModal()">&times;</span>
                <h2>Modificar Partida Manualmente</h2>
                <label for="select-cat-partida"></label>
                <select id="select-cat-partida" onchange="cargarPartidaReferencia(this.value)">
                    <option value="">Categor√≠a...</option>
                    <option value="PI">PI - Producto Importado</option>
                    <option value="PD">PD - Producto a Distribuir</option>
                    <option value="PE">PE - Producto Elab Prop</option>
                    <option value="IP">IP - Insumo Producci√≥n</option>
                    <option value="IG">IG - Mat Prim Granel</option>
                    <option value="SE">SE - Granel Elab Prop</option>
                    <option value="IM">IM - Materias Primas</option>
                    <option value="RE">RE - Repuesto/Comp Elect</option>
                </select>
        
                <label for="input-ultima-partida"></label>
                <input type="text" id="input-ultima-partida" placeholder="Ingresar la nueva ultima partida">
        
                <button id="btn-guardar-partida">Guardar Cambios</button>
            </div>
        </div>
        

       <!-- üîπ Secci√≥n para Escaneo de Productos -->
        <div id="scan-section" class="form-box">
            <h3>Escanear Producto</h3>

            <div class="input-group">
                <label for="codigo">C√≥digo</label>
                <input type="text" id="codigo" placeholder="Escanear c√≥digo" oninput="analizarUDI(this.value)">
            </div>

            <div class="input-group">
                <label for="codigo_tango">C√≥digo Tango</label>
                <input type="text" id="codigo_tango" disabled>
            </div>

            <div class="input-group">
                <label for="ins-mat-prod">INS/MAT/PROD</label>
                <input type="text" id="ins-mat-prod" disabled>
            </div>

            <div class="input-group">
                <label for="proveedor-producto">Proveedor</label>
                <input type="text" id="proveedor-producto" disabled>
            </div>

            <div class="input-group">
                <label for="nro_lote">N√∫mero de Lote</label>
                <input type="text" id="nro_lote">
            </div>

            <div class="input-group">
                <label for="fecha_vto">Fecha de Vencimiento</label>
                <input type="date" id="fecha_vto">
            </div>

            <div class="input-group">
                <label for="temperatura">Temperatura</label>
                <input type="number" id="temperatura">
            </div>

            <div class="input-group">
                <label for="cantidad_ingresada">Cantidad</label>
                <input type="number" id="cantidad_ingresada">
            </div>

            <div class="input-group">
                <label for="nro_partida_asignada">N√∫mero de Partida</label>
                <input type="text" id="nro_partida_asignada">
            </div>

            <button onclick="escanearProducto()">
                <i class="fa-solid fa-file-arrow-up icono"></i> Registrar
            </button>
            
            <p id="producto-mensaje"></p>
        </div>

        <!-- üîπ Formulario para crear una recepci√≥n -->
        <div id="recepcion-section" class="form-box">
            <h3>Crear Recepci√≥n</h3>
            <select id="subproceso">
                <option value="">Seleccione un Subproceso</option>
                <option value="Recepci√≥n">Recepci√≥n</option>
            </select>
            <select id="proveedor">
                <option value="">Seleccione un Proveedor</option>
                <!-- Se llenar√° din√°micamente desde ProductoBase -->
            </select>
            
            <!-- ‚úÖ Nuevo: Lista de productos escaneados para asociar a la recepci√≥n -->
            <div class="table-container">
                <h4>Productos Escaneados</h4>
            <table id="tabla-productos-escaneados">
                <thead>
                    <tr>
                        <th><i class="fa-solid fa-square-check"></i></th>
                        <th>C√≥digo</th>
                        <th>INS/MAT/PROD</th>
                        <th>N¬∞ Lote</th>
                        <th>Fecha Vto</th>
                        <th>Temperatura</th>
                        <th>Cantidad</th>
                        <th>Nro Partida</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody>
                    <!-- Aqu√≠ se insertar√°n los productos escaneados din√°micamente -->
                </tbody>
            </table>
        </div>


            <button onclick="crearRecepcion()"><i class="fas fa-plus"></i> Crear Recepci√≥n</button>
            <p id="recepcion-message"></p>
            
            <button class="btn-ver-recepciones" onclick="window.location.href='/recepciones-listado'">
                <i class="fas fa-list"></i> Ver Recepciones
            </button>
            
             
        </div>
           <!-- üîπ Bot√≥n para ver todas las recepciones -->
      

    </div>

{% endblock %}
